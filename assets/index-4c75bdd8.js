import{A as U,D as Y,r as A,W as rt,a5 as lt,q as D,a2 as dt,$ as X,o as ut,Z as K,k as v,aw as ht,C as ft,B as Z,ar as pt,a0 as _t,Q as O,a1 as P,a7 as vt,ab as mt,ax as q,ap as yt,X as xt,aj as gt,L as kt,G as Ct,I as bt,K as G,_ as Q,u as W,b as f,c as g,w as J,d as E,F as w,f as R,t as St,i as N,e as V,ay as Tt,s as It,v as wt}from"./index-ec12e08f.js";import{T as At,a as $t}from"./index-af14b911.js";import"./index-4f4eded0.js";import{C as Rt,S as Dt}from"./index-4ad4c2a4.js";import{u as tt}from"./city-d17c2344.js";import{a as Lt,u as et}from"./index-769920f1.js";import"./use-id-c4d8d257.js";function Bt(){const t="A".charCodeAt(0);return Array(26).fill("").map((n,i)=>String.fromCharCode(t+i))}const[nt,B]=U("index-bar"),Ot={sticky:ft,zIndex:Z,teleport:[String,Object],highlightColor:String,stickyOffsetTop:pt(0),indexList:{type:Array,default:Bt}},ot=Symbol(nt);var Pt=Y({name:nt,props:Ot,emits:["select","change"],setup(t,{emit:p,slots:n}){const i=A(),_=A(),m=A(""),r=Lt(),u=rt(i),{children:o,linkChildren:y}=lt(ot);let c;y({props:t});const k=D(()=>{if(dt(t.zIndex))return{zIndex:+t.zIndex+1}}),l=D(()=>{if(t.highlightColor)return{color:t.highlightColor}}),S=(e,s)=>{for(let a=o.length-1;a>=0;a--){const h=a>0?s[a-1].height:0,d=t.sticky?h+t.stickyOffsetTop:0;if(e+d>=s[a].top)return a}return-1},T=e=>o.find(s=>String(s.index)===e),L=()=>{if(_t(i))return;const{sticky:e,indexList:s}=t,a=O(u.value),h=P(u),d=o.map(I=>I.getRect(u.value,h));let C=-1;if(c){const I=T(c);if(I){const b=I.getRect(u.value,h);C=S(b.top,d)}}else C=S(a,d);m.value=s[C],e&&o.forEach((I,b)=>{const{state:x,$el:it}=I;if(b===C||b===C-1){const $=it.getBoundingClientRect();x.left=$.left,x.width=$.width}else x.left=null,x.width=null;if(b===C)x.active=!0,x.top=Math.max(t.stickyOffsetTop,d[b].top-a)+h.top;else if(b===C-1&&c===""){const $=d[C].top-a;x.active=$>0,x.top=$+h.top-d[b].height}else x.active=!1}),c=""},z=()=>{vt(L)};X("scroll",L,{target:u,passive:!0}),ut(z),K(()=>t.indexList,z),K(m,e=>{e&&p("change",e)});const st=()=>t.indexList.map(e=>{const s=e===m.value;return v("span",{class:B("index",{active:s}),style:s?l.value:void 0,"data-index":e},[e])}),M=e=>{c=String(e);const s=T(c);if(s){const a=O(u.value),h=P(u),{offsetHeight:d}=document.documentElement;if(s.$el.scrollIntoView(),a===d-h.height){L();return}t.sticky&&t.stickyOffsetTop&&mt(q()-t.stickyOffsetTop),p("select",s.index)}},j=e=>{const{index:s}=e.dataset;s&&M(s)},ct=e=>{j(e.target)};let F;const at=e=>{if(r.move(e),r.isVertical()){yt(e);const{clientX:s,clientY:a}=e.touches[0],h=document.elementFromPoint(s,a);if(h){const{index:d}=h.dataset;d&&F!==d&&(F=d,j(h))}}},H=()=>v("div",{ref:_,class:B("sidebar"),style:k.value,onClick:ct,onTouchstartPassive:r.start},[st()]);return et({scrollTo:M}),X("touchmove",at,{target:_}),()=>{var e;return v("div",{ref:i,class:B()},[t.teleport?v(ht,{to:t.teleport},{default:()=>[H()]}):H(),(e=n.default)==null?void 0:e.call(n)])}}});const[Et,Nt]=U("index-anchor"),Vt={index:Z};var zt=Y({name:Et,props:Vt,setup(t,{slots:p}){const n=xt({top:0,left:null,rect:{top:0,height:0},width:null,active:!1}),i=A(),{parent:_}=gt(ot);if(!_)return;const m=()=>n.active&&_.props.sticky,r=D(()=>{const{zIndex:o,highlightColor:y}=_.props;if(m())return kt(Ct(o),{left:n.left?`${n.left}px`:void 0,width:n.width?`${n.width}px`:void 0,transform:n.top?`translate3d(0, ${n.top}px, 0)`:void 0,color:y})});return et({state:n,getRect:(o,y)=>{const c=P(i);return n.rect.height=c.height,o===window||o===document.body?n.rect.top=c.top+q():n.rect.top=c.top+O(o)-y.top,n.rect}}),()=>{const o=m();return v("div",{ref:i,style:{height:o?`${n.rect.height}px`:void 0}},[v("div",{style:r.value,class:[Nt({sticky:o}),{[bt]:o}]},[p.default?p.default():t.index])])}}});const Mt=G(zt),jt=G(Pt);const Ft={class:"city-list"},Ht={class:"hot"},Xt={class:"item"},Kt={__name:"city-list",props:{cityData:{type:Object,default:()=>({})}},setup(t){const p=t,n=D(()=>{const r=p.cityData.cities.map(u=>u.group);return r.unshift("#"),r}),i=tt(),_=W(),m=r=>{i.currentCity=r,_.back()};return(r,u)=>{const o=Mt,y=Rt,c=jt;return f(),g("div",Ft,[v(c,{"index-list":V(n),sticky:!1},{default:J(()=>[v(o,{index:"热门"}),E("div",Ht,[(f(!0),g(w,null,R(t.cityData.hotCities,(k,l)=>(f(),g("div",Xt,St(k.cityName),1))),256))]),(f(!0),g(w,null,R(t.cityData.cities,k=>(f(),g(w,null,[v(o,{index:k.group},null,8,["index"]),(f(!0),g(w,null,R(k.cities,l=>(f(),N(y,{title:l.cityName,onClick:S=>m(l)},null,8,["title","onClick"]))),256))],64))),256))]),_:1},8,["index-list"])])}}},Ut=Q(Kt,[["__scopeId","data-v-1cc44407"]]);const Yt={class:"city"},Zt={class:"top"},qt={class:"content"},Gt={__name:"index",setup(t){const p=A(),n=A(),i=tt(),{allCity:_}=Tt(i);i.fetchAllCityData();const m=W(),r=()=>{m.back()};return(u,o)=>{const y=Dt,c=At,k=$t;return f(),g("div",Yt,[E("div",Zt,[v(y,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=l=>p.value=l),shape:"round",placeholder:"城市/区域/位置","show-action":"",onCancel:r},null,8,["modelValue"]),v(k,{active:n.value,"onUpdate:active":o[1]||(o[1]=l=>n.value=l)},{default:J(()=>[(f(!0),g(w,null,R(V(_),(l,S,T)=>(f(),N(c,{key:T,title:l.title,name:S},null,8,["title","name"]))),128))]),_:1},8,["active"])]),E("div",qt,[(f(!0),g(w,null,R(V(_),(l,S,T)=>It((f(),N(Ut,{key:T,"city-data":l},null,8,["city-data"])),[[wt,S===n.value]])),128))])])}}},se=Q(Gt,[["__scopeId","data-v-ff13b5f7"]]);export{se as default};
